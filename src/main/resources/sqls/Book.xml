<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rainbow.um.model.IBookDao">

	<!-- 책 추가 -->
	<insert id="bookInsert" parameterType="">
		INSERT INTO BOOK
			(BOOK_NAME, ISBN, BOOK_NUMBER, BOOK_WRITER, BOOK_PUBLISHER, BOOK_PRICE, BOOK_IMG, BOOK_COUNT)
			VALUES('책이름', 123456789012, 000, '지은이', '출판사', 10000, '책그림', 1)
	</insert>
	
	<!-- 추가하는 책 권수 확인 -->
	<select id="bookSelectCount" parameterType="" resultType="">
		SELECT BOOK_COUNT FROM BOOK
			WHERE BOOK_CSEQ='1'
	</select>
	
	<!-- 도서상세 추가 -->
	<insert id="conditionInsert" parameterType="">
		INSERT INTO BOOK_CONDITION
			(BOOK_CSEQ, CONDITION_STORAGE, CONDITION_BORROW, BOOK_DATE)
				VALUES((SELECT BOOK_CSEQ FROM BOOK WHERE BOOK_CSEQ='1'), 'N', 'N', now())
	</insert>
	
	<!-- 책 이미지 수정 -->
	<update id="bookUpdateImg" parameterType="">
		UPDATE BOOK SET BOOK_IMG='이미지' WHERE BOOK_CSEQ='1'
	</update>
	
	<!-- 책 동일 권 수 수정 -->
	<update id="bookUpdateCount" parameterType="">
		UPDATE BOOK SET BOOK_COUNT=3 WHERE BOOK_CSEQ='1'
	</update>

	<!-- 책 상태 수정 -->
	<update id="conditionUpdateStorage" parameterType="">
		UPDATE BOOK_CONDITION SET CONDITION_STORAGE='A' WHERE BOOK_ASEQ='1'
	</update>

	<!-- 책 대출상태 수정 -->
	<update id="conditionUpdateBorrow" parameterType="">
		UPDATE BOOK_CONDITION SET CONDITION_BORROW='Y' WHERE BOOK_ASEQ='1'
	</update>
	
	<!-- 도서 검색 -->
	<select id="bookSelectStorage" parameterType="" resultType="">
		SELECT BOOK_NAME, ISBN, BOOK_NUMBER, BOOK_WRITER, BOOK_PUBLISHER, BOOK_IMG, BOOK_COUNT FROM BOOK 
		WHERE BOOK_COUNT>(SELECT COUNT(*) FROM BOOK B1 
		JOIN BOOK_CONDITION B2 ON B1.BOOK_CSEQ=B2.BOOK_CSEQ
		WHERE B2.CONDITION_STORAGE='U')
			AND BOOK_PUBLISHER='엔이키즈'
			AND BOOK_WRITER LIKE '%김희성%'
			AND BOOK_NAME LIKE '%누가%'
	</select>
	
	<!-- 도서 검색 -->
	<select id="bookSelectList" parameterType="" resultType="">
		SELECT BOOK_NAME, ISBN, BOOK_NUMBER, BOOK_WRITER, BOOK_PUBLISHER, BOOK_IMG, BOOK_COUNT  FROM BOOK 
		WHERE BOOK_PUBLISHER='엔이키즈'
			AND BOOK_WRITER LIKE '%김희성%'
			AND BOOK_NAME LIKE '%누가%'
	</select>
	
	<!-- 상세 도서 검색 -->
	<select id="bookSelectOne" parameterType="" resultType="">
		SELECT BOOK_NAME, ISBN, BOOK_NUMBER, BOOK_WRITER, BOOK_PUBLISHER, BOOK_IMG, BOOK_COUNT  FROM BOOK  WHERE BOOK_CSEQ='1'

		SELECT CONDITION_BORROW,CONDITION_STORAGE,BOOK_DATE FROM \BOOK_CONDITION WHERE BOOK_CSEQ='1'
	</select>
	
	<!-- 반납일 알림 문자 회원 번호 조회 -->
	<select id="userSmsReturn" parameterType="" resultType="">
		SELECT USER_PHONE, USER_EMAIL FROM LOANLIST AS L JOIN USERINFO AS U ON  L.USER_NUMBER=U.USER_NUMBER
		       WHERE (DATE(LOAN_DATE)+7)-DATE(NOW())=2
		       AND DATE(RETURN_DATE)-DATE(NOW())>=0
	</select>
	
	<!-- 예약 순위 회원 번호 조회 -->
	<select id="userResvStep" parameterType="" resultType="">
		SELECT USER_PHONE, USER_EMAIL FROM USERINFO
			WHERE USER_NUMBER=(SELECT USER_NUMBER FROM RESVLIST WHERE BOOK_CSEQ = 1 AND LOAN_CHECK = 'N' LIMIT 0,1)
	</select>
	
</mapper>
